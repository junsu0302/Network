# 네트워크 모델

## 1. 계층 구조의 개념

네트워크에 연결된 시스템이 통신하기 위해서는 데이터를 주고받는 규칙인 **프로토콜**을 따라야한다. 프로토콜의 설계 과정은 **모듈화**를 통해 이루어 진다. 

### 1.1. 계층적 모듈 구조

큰 시스템의 기능은 특정 단위의 모듈로 나누어 설계한다. 모듈은 독립성과 상호 유기성을 지원해야하기 때문에 적절한 인터페이스가 필요하다.

#### 1.1.1. 모듈화

- **하드웨어**
CPU, 메모리, 하드디스크, LAN 카드
- **소프트웨어**
기능별 함수

#### 1.1.2. 계층 구조

분할 된 모듈은 상하위의 **계층 구조**로 연결되어 동작한다. 계층 구조는 특정 모듈이 다른 모듈에 서비스를 제공하는 형식으로 이루어진다. 모듈화된 계층 구조 프로토콜은 다음과 같은 장점이 있다.

```markdown
1. 전체 시스템 이해가 쉽고, 시스템 설계 및 구현 편리
2. 표준 인터페이스를 통한 시스템 구조 단순화
3. 대칭 구조를 통한 통신 양단의 통일 계층 사이 프로토콜 단순화
4. 기능 오류 시 모듈만 수정
```

### 1.2. 프로토콜 설계 시 고려 사항

프로토콜 설계 시 다음과 같은 사항들을 고려해야 한다

```markdown
1. 주소 표현 : 호스트 구분
2. 오류 제어 : 데이터 오류 시 복구
3. 흐름 제어 : 수신 오류 시 복구
```

#### 1.2.1. 주소 표현

**주소 체계** : 시스템을 구분하여 지징하기 위해 이름을 부여하는 방식

일대다 통신 지원을 위해 다음과 같은 방식을 사용한다.

```markdown
1. 브로드캐스팅 : 모든 호스트에 데이터 전송
2. 멀티캐스팅 : 특정 사용자를 그룹으로 묶어 지칭
```

#### 1.2.2. 오류 제어

**오류 제어**는 데이터 송수신 과정 중 발생하는 데이터 변형 및 분실 오류를 제어하는 방법이다. 이러한 문제는 물리 계층의 전송 매체에 의한 물리적 오류로 인해 발생한다.

```markdown
데이터 분실 or 변형
1. 송신 호스트가 오류 감지
2. 오류 감지 시 데이터 재전송
```

#### 1.2.3. 흐름 제어

**흐름 제어**는 데이터 송수신 과정 중 데이터 분실 오류를 제어하는 방법이다. 이러한 문제는 다음과 같은 송수신 호스트 사이 데이터 전송/처리 속도 차이로 인해 발생한다. 

```markdown
1. 수신 호스트에 데이터 도착
2. 수신 호스트 내부 버퍼에 보관 후 처리
3. 보관 공간 확보 실패 시 데이터 논리적 분실
```

이러한 문제를 해결하기 위해 다음과 같은 방법을 사용한다.

```markdown
1. 송신 호스트 : i번 데이터 전송
2. 수신 호스트 : 다음 데이터 전송 허가
3. 송신 호스트 : i+1번 데이터 전송
```

#### 1.2.4. 데이터 전달 방식

데이터 전달 방식은 다음과 같다

```markdown
1. 단방향 : 일대일 통신 환경에서 데이터 한쪽 방향으로만 전송 
2. 전이중 : 일대일 통신 환경에서 데이터 양쪽 동시 전송
3. 반이중 : 일대일 통신 환경에서 양뱡향 전송 중 특정 상황에서 단방향
```

### 1.3. 서비스 프리미티브

계층 구조 프로토콜에서 하위 계층이 상위 계층에 서비스를 제공하는 방식을 구현하는 형태를 **프리미티브**라고 한다. 즉 프리미티브는 하위 계층을 사용하는 방법을 정량화한 것이다. 통신 프로토콜에서 프리미티브를 올바르게 수행하기 위해서는 서비스 종류에 맞는 기능을 부여해야한다. 서비스의 종류에는 **연결형**과 **비연결형**이 있다. 

- **연결형 서비스**
```markdown
1. 데이터 전달 경로 설정
2. 데이터 전송
3. 데이터 전달 경로 연결 해제
```
- **비연결형 서비스**
```markdown
1. 데이터의 독립적 경로 선택 및 전송
2. 전송순서 != 도착순서
```

각 서비스에 맞는 프리미티브는 다음과 같이 구현된다.

- **연결형 서비스 프리미티브**
```markdown
1. CONNECT :연결 설정
2. DATA : 데이터 전송
3. DISCONNECT : 연결 해제
```

- **비연결형 서비스 프리미티브**
```markdown
1. Request : 클라이언트가 서버에 서비스 요청
> 연결 설정 요청, 데이터 전송 요청, 연결 해제 요청

2. Indication : 서버에 서비스 요청이 도착했음 통지
> 연결 설정, 데이터 전송, 연결 해제

3. Response : 서버가 클라이언트에 서비스 응답 회신
> 연결 허용 or 거부, 데이터 전송, 연결 해제

4. Confirm : 클라이언트에 응답이 도착했음 통지
> 연결 설정, 데이터, 연결 해제
```

## 2. OSI 참조 모델

네트워크 연결에서 표준화된 인터페이스 지원을 위해 계층 구조로 **모듈화된 프로토콜 스택**을 사용한다. 데이터 통신 환경에 적합한 계층적 구현 모델로는 **OSI 7계층 모델**이 있다.

### 2.1. OSI 7계층 모델

연결된 두 호스트가 각각 7계층으로 구성된 모듈을 수행함으로써 데이터 송수신을 하는 모델이다.
```markdown
송신 호스트 : 상위계층 -> 하위계층
송신 호스트 물리계층 -> 수신 호스트 물리계층
수신 호스트 : 하위계층 -> 상위계층
```

데이터가 하위계층으로 내려갈 떄는 각 계층의 프로토콜에서 정의한 헤더 정보가 추가된다.

데이터를 수신하는 호스트에서는 상위계층으로 올라갈 때 순차적으로 헤더 정보를 제거하고 해석한다.

#### 2.1.1. 용어 정의

- **계층 n 프로토콜**
```markdown
임의의 호스트에서 실행되는 계층 n 모듈이 상대 호스트의 계층 n 모듈과 논리적으로 통신하는 규칙
```

- **동료 프로세스**
```markdown
동일한 계층에 위치한 통신 양단
```

- **인터페이스**
```markdown
호스트에서 상하로 이웃하는 모듈 사이 접근 방법
```

- **서비스**
```markdown
하위 계층에서 상위 계층으로 지원하는 인터페이스
```

송신 호스트에서 데이터를 전달할 때는 동료 프로세스에 직접 전달 X
> 하위 계층을 통해 간접적으로 서비스 요청

#### 2.1.2. 헤더 정보

```markdown
1. 송신 호스트에서 상위 계층에서 하위 계층으로 내려가면서 각 계층별 프로토콜의 헤더 정보를 추가한다.
2. 수신 호스트에서 하위 계층에서 상위 계층으로 올라가면서 각 계층별 추가된 헤더 정보를 해석 및 삭제한다.
> 각 계층의 프로토콜은 정해진 기능을 수행하여 데이터 송신 과정에서 발생하는 문제점을 해결한다.
```

#### 2.1.3. 중개 기능

중개 시스템은 데이터가 목적지까지 올바르게 전달되도록 경로 배정 기능을 수행한다.

- **라우팅**
```markdown
경로 배정 기능을 수행하는 네트워크 계층의 프로토콜
```

### 2.2. 계층별 기능

OSI 7계층 모델에서 전송 계층은 통신 양단에 있는 최종 사용자 사이의 종단 연결을 제공한다. 즉 데이터를 주고받을 수 있게 해주기 때문에 전송 계층을 기준으로 상위 계층과 하위 계층으로 구분한다.

#### 2.2.1. 물리 계층

```markdown
전송 매체의 물리적 인터페이스에 관한 사항 기술
> 개별 정보의 bit 교환 문제
> 하드웨어 시스템으로 구현
> 전송 속도, 송수신 호스트 사이 클록, 물리적 연결 등
```

#### 2.2.2. 데이터 링크 계층

```markdown
1. 물리 계층을 통해 전송되는 데이터의 물리적 전송 오류 해결
> 상위 계층에 신뢰성 있는 패킷 전송
2. 흐름 제어 기능 지원
3. 프레임 : 데이터 링크 계층을 통해 전송되는 데이터
4. 프레임 헤더 : LAN 카드에 내장된 송수신 호스트의 MAC 주소
```

#### 2.2.3. 네트워크 계층

```markdown
1. 송신 호스트가 전송한 데이터가 어떤 경로를 통해 전달되는지 결정
> 정적 라우팅 : 전달 경로 선택을 미리 결정
> 동적 라우팅 : 네트워크의 현재 부하 상태에 따라 결정
2. 혼잡 제어 기능 지원
3. 패킷 : 네트워크 계층을 통해 전송되는 데이터
> 중개 과정에서 경로 선택 기준이 되는 호스트 주소 포함
```

#### 2.2.4. 전송 계층

```markdown
1. 송수신 프로세스를 직접 연결하는 단대단 통신 기능 제공
2. 컴퓨터 내부에서 논리적으로 구축되는 통신 프로세스 사이 통신 문제 담당
3. 서비스 요구 유형 고려 및 흐름 제어 기능 지원
```

#### 2.2.5. 세션 계층

```markdown
1. 사용자와의 상위적 연결 계념인 세션 기능 제공
2. 토큰 제어 : 송수신 호스트 사이의 대환 제어를 비롯한 상호 배타적 동작
3. 동기 : 일시적인 전송 장애 해결
```

#### 2.2.6. 표현 계층

```markdown
1. 데이터의 의미 및 표현 방법 처리
> 통신 양단이 이해 가능한 표준 방식으로 데이터 코딩
2. 암호화 및 압축 기능 지원
```

#### 2.2.7. 응용 계층

```markdown
1. 응용 환경에서 공통으로 필요한 기능 지원
2. FTP(File Transfer Protocol)에서 시작
```

## 3. TCP/IP 모델

네트워크 계층은 **IP 프로토콜**을 사용한다. 전송 계층은 **TCP** or **UCP**를 사용한다.

### 3.1. 구현 환경

컴퓨터 네트워크 구현 모델에서는 사용자 공간과 시스템 공간으로 나누어진다. 네트워크 구현 모델은 전송 계층까지의 기능을 시스템 공간인 운영체제 내부에 구현한다. TCP/IP와 하위 계층의 기능을 담당하는 LAN 카드 드라이버 루틴은 운영체제 영역에 속한다.

#### 3.1.1. 시스템 공간

```markdown
TCP : 연결형 서비스 제공
UDP : 비연결형 서비스 제공

TCP/UDP는 시스템 운영체제인 커널 내부에 구현
> 일반 사용자가 직접 사용 불가
>> 소켓 인터페이스라는 전송 계층의 프리미티브 사용
>> 사용자가 호출(시스템 콜)

IP : 전송 패킷의 올바른 경로 선택 기능 제공
> 네트워크 계층 구현

LAN 카드 드라이버 루틴
> 네트워크 계층 하위 계층 구현
```

#### 3.1.2. 사용자 공간

```markdown
세션 ~ 응용 계층까지 기능 : 사용자 프로그램으로 구현

전송 계층 기능 : 소켓 시스템 콜 호출을 통한 TCP or UDP 기능
1. 소켓마다 부여되는 포트번호(고유주소) 관리
2. 고유 주소 : IP 주소와 포트 번호의 조합
```

### 3.2. 프로토콜

TCP/IP 모델에서 사용자 데이터의 전송이 올바르게 동작하기 위해서는 **ARP/RARP**와 **ICMP**가 필요하다.
```markdown
ARP/RARP : 주소 문제 해결
ICMP : 오류 문제 해결
```

#### 3.2.1. TCP/IP 계층 구조

네트워크 응용 프로그램은 TCP or UDP를 사용해 데이터 송수신 기능을 수행하지만, 네트워크 계층의 IP 프로토콜을 직접 사용하기도 한다. 이때 ICMP와 ARP/RARP는 네트워크 계층에 소속되어 IP의 동작을 도와준다.

#### 3.2.2. ARP/RARP

TCP/IP에서 사용하는 주소는 다음과 같다.
```markdown
1. MAC 주소 : 데이터 링크 계층
2. IP 주소 : 네트워크 계층
3. 포트 번호 : 전송 계층
> 사용자 프로그램 환경에서 사용
> 다른 계층 프로토콜 동작에 큰 영향 X
```

송신 호스트는 자신의 IP, MAC 주소를 얻기 쉽다. 하지만 수신 호스트의 주소를 얻기 위해서는 처리 단계가 필요하다.

- **ARP**
```markdown
1. 사용자로부터 입력된 상대방 호스트의 IP 주소 저장
2. 상대방 IP 주소를 이용해 상대 MAC 주소 제공
```

- **RARP**
```markdown
호스트의 IP 주소는 컴퓨터 설정 작업의 초기화 과정에서 특정 파일에 저장
> 하드 디스크가 없는 시스템은 파일 시스템이 존재하지 않아 IP 주소를 알 수 없음

자신의 LAN 카드에 내장된 MAC 주소를 이용해 본인 IP 주소 제공
```

#### 3.2.3. ICMP

```markdown
1. 사용자 데이터의 전송 과정에서 오류 발생
2. 송신자에게 오류 회신
3. 복구 잡업
```
